{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- link for CSS  -->
    <link rel="stylesheet" href="../static/CSS/style.css">
    <link rel="stylesheet" href="../static/CSS/md.css">
    <link rel="stylesheet" href="../static/CSS/sm.css">




    <!-- link for Bootstrap CSS  -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


    <!-- link for icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <title>Final Project</title>
</head>

<body>

    <!-- Navbar section -->
    <header id="header" class="header">
        <a href="#">
            <img class="logo" src="../static/Images/logo2.png" alt="logo">
        </a>

        <div>
            <ul id="navbar" class="navbar">
                <li><a href="index">Home</a></li>
                <li><a href="shop">Shop</a></li>
                <li><a href="blog">Blog</a></li>
                <li><a href="about">About</a></li>
                <li><a href="contact">Contact</a></li>
                <li class="cart"><a class="active" href="cart"><i class="fa-solid fa-cart-shopping"></i></a></li>
                <li class="user"><a href="signup"><i class="fa-solid fa-user"></i></i></a></li>
                <a href="#" id="close" class="close"><i class="fa-solid fa-xmark" onclick="closei()"></i></a>
            </ul>
        </div>
        <div id="tablet" class="tablet">
            <a href="cart"><i class="fa-solid fa-cart-shopping"></i></a>
            <li class="cart"><a href="signup"><i class="fa-solid fa-user"></i></i></a></li>
            <i id="bar" class="fa-solid fa-outdent" onclick="icon()"></i>
        </div>
    </header>

    <!-- Home section  -->
    <section id="section-1" class="contact-header">
        <h2>#let's_talk</h2>
        <p>LEAVE A MESSAGE, We love to hear from you!</p>
    </section>

    <section id="cart-section" class="cart-section">
        <table width="100%">
            <thead>
                <tr>
                    <td>REMOVE</td>
                    <td>PRODUCT</td>
                    <td>PRICE</td>
                    <td>SIZE</td>
                    <td>SUBTOTAL</td>
                </tr>
            </thead>

            <tbody id="cart-items">
                <!-- Cart items will be dynamically inserted here -->
            </tbody>
        </table>
    </section>

    <section id="cart-add" class="cart-add">

        <div id="subtotal" class="subtotal">
            <h3>Cart Totals</h3>
            <table>
                <tr>
                    <td>Cart Subtaotal</td>
                    <td id="cart-subtotal">$ 0.00</td>
                </tr>

                <tr>
                    <td>Shipping</td>
                    <td>Free</td>
                </tr>

                <tr>
                    <td><strong>Total</strong></td>
                    <td><strong id="cart-total">$ 0.00</strong></td>
                </tr>
            </table>
            <button class="btn-7">Proceed to checkout</button>
        </div>
    </section>

    <!-- Footer section  -->
    <footer id="footer" class="footer">
        <div class="col1">
            <img class="logo1" src="../static/Images/logo2.png" alt="">
            <h4>Contact</h4>
            <p><strong>Address:</strong> 562 Wellington Road, Street 32, San Francisco</p>
            <p><strong>Phone:</strong> (+91) 9510670132 / (+91) 8866830048</p>
            <p><strong>Hours:</strong> 10:00 - 18:00, Mon - Sat</p>
            <div class="follow">
                <h4>Follow us</h4>
                <div class="icon">
                    <i class="fa-brands fa-facebook">
                        <a href="https://www.facebook.com/login/"></a>
                    </i>
                    <i class="fa-brands fa-x-twitter">
                        <a href="https://twitter.com/i/flow/login"></a>
                    </i>
                    <i class="fa-brands fa-instagram">
                        <a href="https://www.instagram.com/accounts/login/"></a>
                    </i>
                    <i class="fa-brands fa-whatsapp">
                        <a href="https://www.whatsapp.com/"></a>
                    </i>
                    <i class="fa-brands fa-youtube">
                        <a href="https://www.youtube.com/"></a>
                    </i>
                </div>
            </div>
        </div>

        <div class="col2">
            <h4>About</h4>
            <a href="#">About Us</a>
            <a href="#">Delivery Information</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms & Conditions</a>
            <a href="#">Contact Us</a>
        </div>

        <div class="col3">
            <h4>My Account</h4>
            <a href="signup">Sign-Up</a>
            <a href="login">Sign-In</a>
            <a href="cart">View Cart</a>
            <a href="cart">My Wishlist</a>
            <a href="#">Track My Order</a>
            <a href="#">Help</a>
        </div>

        <div class="col4">
            <h4>Install App</h4>
            <p>From App Store or Google Play Store</p>
            <div class="f-row">
                <img src="../static/Images/pay/app.jpg" alt="">
                <img src="../static/Images/pay/play.jpg" alt="">
            </div>
            <p>Secured Payment Gateways</p>
            <img src="../static/Images/pay/pay.png" alt="">
        </div>

        <div class="copyright">
            <p>&copy; 2024, E-Commerce Website</p>
        </div>
    </footer>

    <!-- link for Javascript -->
    <script src="../static/js/app.js"></script>

    <!-- link for Bootsrap Javascript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- IndexedDB and cart functionality -->
    <script>
        // IndexedDB setup
        let db;
        const request = indexedDB.open("CartDB", 1);

        request.onupgradeneeded = function (event) {
            db = event.target.result;
            const objectStore = db.createObjectStore("cart", { keyPath: "id", autoIncrement: true });
            objectStore.createIndex("name", "name", { unique: false });
            objectStore.createIndex("price", "price", { unique: false });
            objectStore.createIndex("size", "size", { unique: false });
        };

        request.onsuccess = function (event) {
            db = event.target.result;
            displayCartItems();
        };

        request.onerror = function (event) {
            console.error("Database error: " + event.target.errorCode);
        };

        // Function to display cart items
        function displayCartItems() {
            const transaction = db.transaction(["cart"], "readonly");
            const objectStore = transaction.objectStore("cart");

            const cartItems = [];
            const request = objectStore.openCursor();

            request.onsuccess = function (event) {
                const cursor = event.target.result;
                if (cursor) {
                    cartItems.push(cursor.value);
                    cursor.continue();
                } else {
                    renderCartItems(cartItems);
                }
            };

            request.onerror = function (event) {
                console.error("Error retrieving items: ", event.target.errorCode);
            };
        }

        // Function to render cart items in the table
        function renderCartItems(items) {
            const cartItemsTable = document.getElementById("cart-items");
            let subtotal = 0;

            items.forEach(item => {
                const row = document.createElement("tr");

                const removeCell = document.createElement("td");
                const deleteButton = document.createElement("button");
                deleteButton.classList.add("btn", "btn-link", "text-danger", "p-0", "border-0", "bg-transparent");
                deleteButton.innerHTML = `<i class="fa-regular fa-circle-xmark"></i>`;
                deleteButton.onclick = function () {
                    // Delete item from IndexedDB
                    const transaction = db.transaction(["cart"], "readwrite");
                    const objectStore = transaction.objectStore("cart");
                    objectStore.delete(item.id);

                    // Remove item from table
                    row.remove();

                    // Update cart totals
                    updateCartTotals();
                };
                removeCell.appendChild(deleteButton);
                row.appendChild(removeCell);

                const nameCell = document.createElement("td");
                nameCell.textContent = item.name;
                row.appendChild(nameCell);

                const priceCell = document.createElement("td");
                priceCell.textContent = item.price;
                row.appendChild(priceCell);

                const sizeCell = document.createElement("td");
                sizeCell.textContent = item.size;
                row.appendChild(sizeCell);

                const subtotalCell = document.createElement("td");
                const price = parseFloat(item.price.replace('$', '')); // Assuming price is in format $x.xx
                subtotalCell.textContent = `$${price.toFixed(2)}`;
                row.appendChild(subtotalCell);

                subtotal += price;

                cartItemsTable.appendChild(row);
            });

            // Update cart totals
            document.getElementById("cart-subtotal").textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById("cart-total").textContent = `$${subtotal.toFixed(2)}`;
        }

        function updateCartTotals() {
            const cartItemsTable = document.getElementById("cart-items");
            let subtotal = 0;

            Array.prototype.forEach.call(cartItemsTable.rows, function (row) {
                const priceCell = row.cells[2];
                const price = parseFloat(priceCell.textContent.replace('$', ''));
                subtotal += price;
            });

            document.getElementById("cart-subtotal").textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById("cart-total").textContent = `$${subtotal.toFixed(2)}`;
        };
    </script>
</body>

</html>